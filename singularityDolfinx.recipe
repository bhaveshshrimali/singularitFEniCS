Bootstrap: docker
From: dolfinx/dolfinx:latest

%post
    apt-get -y update
    apt-get -y install libcgal-dev libeigen3-dev 
    apt-get -y install software-properties-common ffmpeg curl build-essential python3 python3-pip python3-tk
    apt-get -y install python3-lxml nano
    python3 -m pip install numpy scipy matplotlib pandas ffmpeg-python openpyxl vedo
    python3 -m pip install meshio lxml pygmsh pyamg jupyter notebook ipython
    apt-get -y update
    git clone https://github.com/jorgensd/dolfinx_mpc.git 
    cd dolfinx_mpc
    rm -rf build
    mkdir -p build
    cd build
    export PETSC_DIR=/usr/local/petsc
    export SLEPC_DIR=/usr/local/slepc
    cmake -G Ninja -DCMAKE_BUILD_TYPE=Developer ../cpp/
    ninja -j3 install
    cd ../python
    python3 -m pip install . --upgrade
    apt-add-repository universe
    add-apt-repository ppa:ngsolve/ngsolve
    apt-get -y update
    apt-get -y install ngsolve
    ldconfig

%runscript
    exec /bin/bash -i